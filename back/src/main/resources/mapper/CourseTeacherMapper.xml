<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pears.asa.dao.CourseTeacherDao">

    <insert id="addCourse" parameterType="com.alibaba.fastjson.JSONObject">
        INSERT INTO course_teacher
        (content
        <if test="brief !='' and brief !=null">
            , brief
        </if>
        <if test="capacity !='' and capacity !=null">
            , capacity
        </if>
        <if test="courseDate !='' and courseDate !=null">
            , course_date
        </if>
        <if test="tuition !='' and tuition !=null">
            , tuition
        </if>
        <if test="createUser !='' and createUser !=null">
            , create_user
        </if>
        <if test="updateUser !='' and updateUser !=null">
            , update_user
        </if>
        <if test="startDate !='' and startDate !=null">
            , start_date
        </if>
        <if test="endDate !='' and endDate !=null">
            , end_date
        </if>
        <if test="teacherType !='' and teacherType !=null">
            , teacher_type
        </if>
        <if test="grade !='' and grade !=null">
            , grade
        </if>
        <if test="tuitionType !='' and tuitionType !=null">
            , tuition_type
        </if>
        <if test="finalTuition !='' and finalTuition !=null">
            , final_tuition
        </if>
        ) VALUES
            ( #{content}
        <if test="brief !='' and brief !=null">
            , #{brief}
        </if>
        <if test="capacity !='' and capacity !=null">
            , #{capacity}
        </if>
        <if test="courseDate !='' and courseDate !=null">
            , #{courseDate}
        </if>
        <if test="tuition !='' and tuition !=null">
            , #{tuition}
        </if>
        <if test="createUser !='' and createUser !=null">
            , #{createUser}
        </if>
        <if test="updateUser !='' and updateUser !=null">
            , #{updateUser}
        </if>
        <if test="startDate !='' and startDate !=null">
            , #{startDate}
        </if>
        <if test="endDate !='' and endDate !=null">
            , #{endDate}
        </if>
        <if test="teacherType !='' and teacherType !=null">
            , #{teacherType}
        </if>
        <if test="grade !='' and grade !=null">
            , #{grade}
        </if>
        <if test="tuitionType !='' and tuitionType !=null">
            , #{tuitionType}
        </if>
        <if test="finalTuition !='' and finalTuition !=null">
            , #{finalTuition}
        </if>
        )
    </insert>

    <select id="countCourse" resultType="Integer">
        SELECT count(0)
        FROM course_teacher w
        WHERE w.delete_status = '1'
        <if test="content !='' and content !=null">
            AND w.content like concat(concat('%',#{content}),'%')
        </if>
        <if test="author !='' and author !=null">
            AND w.create_user = #{author}
        </if>
        <if test="studentCanPick !='' and studentCanPick !=null">
            and w.id not in (select course_id from course_student where select_user_id = #{studentCanPick})
        </if>
    </select>

    <select id="listCourse" resultType="com.alibaba.fastjson.JSONObject">
        SELECT
        w.id id,
        w.content content,
          date_format(w.create_time, '%Y.%m.%d %T') createTime,
          date_format(w.update_time, '%Y.%m.%d %T') updateTime,
          u.nickname,
          w.brief,
          w.capacity,
          w.course_date courseDate,
          w.tuition,
          w.create_user,
          w.update_user,
          w.grade,
          w.tuition_type tuitionType,
          w.final_tuition finalTuition
        FROM course_teacher w
          LEFT JOIN sys_user u ON w.create_user = u.id
        WHERE w.delete_status = '1'
        <if test="content !='' and content !=null">
            AND w.content like concat(concat('%',#{content}),'%')
        </if>
        <if test="author !='' and author !=null">
            AND w.create_user = #{author}
        </if>
        <if test="studentCanPick !='' and studentCanPick !=null">
            and w.id not in (select course_id from course_student where select_user_id = #{studentCanPick})
        </if>
        LIMIT #{offSet}, #{pageRow}
    </select>

    <update id="updateCourse" parameterType="com.alibaba.fastjson.JSONObject">
        UPDATE course_teacher
           SET id = id
        <if test="content !='' and content !=null">
            , content = #{content}
        </if>
        <if test="brief !='' and brief !=null">
            , brief = #{brief}
        </if>
        <if test="capacity !='' and capacity !=null">
            , capacity = #{capacity}
        </if>
        <if test="courseDate !='' and courseDate !=null">
            , course_date = #{courseDate}
        </if>
        <if test="tuition !='' and tuition !=null">
            , tuition = #{tuition}
        </if>
        <if test="createUser !='' and createUser !=null">
            , create_user = #{createUser}
        </if>
        <if test="updateUser !='' and updateUser !=null">
            , update_user = #{updateUser}
        </if>
        <if test="deleteStatus !='' and deleteStatus !=null">
            , delete_status = #{deleteStatus}
        </if>
        <if test="teacherType !='' and teacherType !=null">
            , teacher_type = #{teacherType}
        </if>
        <if test="grade !='' and grade !=null">
            , grade = #{grade}
        </if>
        WHERE id = #{id}
    </update>

</mapper>